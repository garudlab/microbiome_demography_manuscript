'../Analysis/Bacteroidales_bacterium_58650_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Alistipes_putredinis_61533_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Alistipes_finegoldii_56071_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Alistipes_onderdonkii_55464_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Alistipes_shahii_62199_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Odoribacter_splanchnicus_62174_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Parabacteroides_distasonis_56985_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Parabacteroides_merdae_56972_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Prevotella_copri_61740_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Bacteroides_fragilis_54507_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Bacteroides_cellulosilyticus_58046_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Bacteroides_stercoris_56735_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Bacteroides_uniformis_57318_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Bacteroides_thetaiotaomicron_56941_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Bacteroides_xylanisolvens_57185_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Bacteroides_caccae_53434_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Bacteroides_vulgatus_57955_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Barnesiella_intestinihominis_62208_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Akkermansia_muciniphila_55290_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Dialister_invisus_61905_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Phascolarctobacterium_sp_59817_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Eubacterium_eligens_61678_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Eubacterium_rectale_56927_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Oscillibacter_sp_60799_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Ruminococcus_bromii_62047_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Ruminococcus_bicirculans_59300_downsampled_14/core_one_epoch_demography.txt',
'../Analysis/Faecalibacterium_prausnitzii_57453_downsampled_14/core_one_epoch_demography.txt'
)
two_epoch_file_list = c(
'../Analysis/Bacteroidales_bacterium_58650_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Alistipes_putredinis_61533_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Alistipes_finegoldii_56071_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Alistipes_onderdonkii_55464_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Alistipes_shahii_62199_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Odoribacter_splanchnicus_62174_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Parabacteroides_distasonis_56985_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Parabacteroides_merdae_56972_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Prevotella_copri_61740_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Bacteroides_fragilis_54507_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Bacteroides_cellulosilyticus_58046_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Bacteroides_stercoris_56735_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Bacteroides_uniformis_57318_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Bacteroides_thetaiotaomicron_56941_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Bacteroides_xylanisolvens_57185_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Bacteroides_caccae_53434_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Bacteroides_vulgatus_57955_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Barnesiella_intestinihominis_62208_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Akkermansia_muciniphila_55290_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Dialister_invisus_61905_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Phascolarctobacterium_sp_59817_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Eubacterium_eligens_61678_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Eubacterium_rectale_56927_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Oscillibacter_sp_60799_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Ruminococcus_bromii_62047_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Ruminococcus_bicirculans_59300_downsampled_14/core_two_epoch_demography.txt',
'../Analysis/Faecalibacterium_prausnitzii_57453_downsampled_14/core_two_epoch_demography.txt'
)
accessory_two_epoch_file_list = c(
'../Analysis/Bacteroidales_bacterium_58650_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Alistipes_putredinis_61533_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Alistipes_finegoldii_56071_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Alistipes_onderdonkii_55464_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Alistipes_shahii_62199_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Odoribacter_splanchnicus_62174_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Parabacteroides_distasonis_56985_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Parabacteroides_merdae_56972_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Prevotella_copri_61740_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Bacteroides_fragilis_54507_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Bacteroides_cellulosilyticus_58046_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Bacteroides_stercoris_56735_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Bacteroides_uniformis_57318_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Bacteroides_thetaiotaomicron_56941_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Bacteroides_xylanisolvens_57185_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Bacteroides_caccae_53434_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Bacteroides_vulgatus_57955_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Barnesiella_intestinihominis_62208_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Akkermansia_muciniphila_55290_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Dialister_invisus_61905_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Phascolarctobacterium_sp_59817_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Eubacterium_eligens_61678_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Eubacterium_rectale_56927_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Oscillibacter_sp_60799_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Ruminococcus_bromii_62047_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Ruminococcus_bicirculans_59300_downsampled_14/accessory_two_epoch_demography.txt',
'../Analysis/Faecalibacterium_prausnitzii_57453_downsampled_14/accessory_two_epoch_demography.txt'
)
three_epoch_file_list = c(
'../Analysis/Bacteroidales_bacterium_58650_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Alistipes_putredinis_61533_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Alistipes_finegoldii_56071_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Alistipes_onderdonkii_55464_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Alistipes_shahii_62199_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Odoribacter_splanchnicus_62174_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Parabacteroides_distasonis_56985_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Parabacteroides_merdae_56972_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Prevotella_copri_61740_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Bacteroides_fragilis_54507_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Bacteroides_cellulosilyticus_58046_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Bacteroides_stercoris_56735_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Bacteroides_uniformis_57318_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Bacteroides_thetaiotaomicron_56941_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Bacteroides_xylanisolvens_57185_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Bacteroides_caccae_53434_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Bacteroides_vulgatus_57955_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Barnesiella_intestinihominis_62208_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Akkermansia_muciniphila_55290_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Dialister_invisus_61905_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Phascolarctobacterium_sp_59817_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Eubacterium_eligens_61678_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Eubacterium_rectale_56927_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Oscillibacter_sp_60799_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Ruminococcus_bromii_62047_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Ruminococcus_bicirculans_59300_downsampled_14/core_three_epoch_demography.txt',
'../Analysis/Faecalibacterium_prausnitzii_57453_downsampled_14/core_three_epoch_demography.txt'
)
species_list = c(
'Bacteroidales_bacterium_58650',
'Alistipes_putredinis_61533',
'Alistipes_finegoldii_56071',
'Alistipes_onderdonkii_55464',
'Alistipes_shahii_62199',
'Odoribacter_splanchnicus_62174',
'Parabacteroides_distasonis_56985',
'Parabacteroides_merdae_56972',
'Prevotella_copri_61740',
'Bacteroides_fragilis_54507',
'Bacteroides_cellulosilyticus_58046',
'Bacteroides_stercoris_56735',
'Bacteroides_uniformis_57318',
'Bacteroides_thetaiotaomicron_56941',
'Bacteroides_xylanisolvens_57185',
'Bacteroides_caccae_53434',
'Bacteroides_vulgatus_57955',
'Barnesiella_intestinihominis_62208',
'Akkermansia_muciniphila_55290',
'Dialister_invisus_61905',
'Phascolarctobacterium_sp_59817',
'Eubacterium_eligens_61678',
'Eubacterium_rectale_56927',
'Oscillibacter_sp_60799',
'Ruminococcus_bromii_62047',
'Ruminococcus_bicirculans_59300',
'Faecalibacterium_prausnitzii_57453'
)
AIC_matrix = data.frame(
one_epoch = numeric(27),
two_epoch = numeric(27),
three_epoch = numeric(27),
delta_AIC = numeric(27))
row.names(AIC_matrix) = species_list
for (i in 1:length(species_list)) {
AIC_matrix[i, 1] = AIC_from_demography(one_epoch_file_list[i])
AIC_matrix[i, 2] = AIC_from_demography(two_epoch_file_list[i])
AIC_matrix[i, 3] = AIC_from_demography(three_epoch_file_list[i])
AIC_matrix[i, 4] = abs(min(AIC_matrix[i, 1], AIC_matrix[i, 3]) - AIC_matrix[i, 2])
}
AIC_matrix
# write.csv(AIC_matrix,  file='../Summary/AIC_matrix.csv')
#  Distributions of Nu and Tau
likelihood_surface_file_list = c(
'../Analysis/Bacteroidales_bacterium_58650_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Alistipes_putredinis_61533_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Alistipes_finegoldii_56071_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Alistipes_onderdonkii_55464_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Alistipes_shahii_62199_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Odoribacter_splanchnicus_62174_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Parabacteroides_distasonis_56985_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Parabacteroides_merdae_56972_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Prevotella_copri_61740_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Bacteroides_fragilis_54507_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Bacteroides_cellulosilyticus_58046_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Bacteroides_stercoris_56735_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Bacteroides_uniformis_57318_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Bacteroides_thetaiotaomicron_56941_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Bacteroides_xylanisolvens_57185_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Bacteroides_caccae_53434_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Bacteroides_vulgatus_57955_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Barnesiella_intestinihominis_62208_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Akkermansia_muciniphila_55290_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Dialister_invisus_61905_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Phascolarctobacterium_sp_59817_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Eubacterium_eligens_61678_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Eubacterium_rectale_56927_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Oscillibacter_sp_60799_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Ruminococcus_bromii_62047_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Ruminococcus_bicirculans_59300_downsampled_14/core_likelihood_surface.csv',
'../Analysis/Faecalibacterium_prausnitzii_57453_downsampled_14/core_likelihood_surface.csv'
)
synonymous_sfs_file_list = c(
'../Analysis/Bacteroidales_bacterium_58650_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Alistipes_putredinis_61533_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Alistipes_finegoldii_56071_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Alistipes_onderdonkii_55464_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Alistipes_shahii_62199_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Odoribacter_splanchnicus_62174_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Parabacteroides_distasonis_56985_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Parabacteroides_merdae_56972_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Prevotella_copri_61740_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Bacteroides_fragilis_54507_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Bacteroides_cellulosilyticus_58046_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Bacteroides_stercoris_56735_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Bacteroides_uniformis_57318_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Bacteroides_thetaiotaomicron_56941_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Bacteroides_xylanisolvens_57185_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Bacteroides_caccae_53434_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Bacteroides_vulgatus_57955_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Barnesiella_intestinihominis_62208_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Akkermansia_muciniphila_55290_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Dialister_invisus_61905_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Phascolarctobacterium_sp_59817_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Eubacterium_eligens_61678_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Eubacterium_rectale_56927_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Oscillibacter_sp_60799_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Ruminococcus_bromii_62047_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Ruminococcus_bicirculans_59300_downsampled_14/core_empirical_syn_downsampled_sfs.txt',
'../Analysis/Faecalibacterium_prausnitzii_57453_downsampled_14/core_empirical_syn_downsampled_sfs.txt'
)
nu_tau_distribution = data.frame(species=phylogenetic_levels,
nu_mle = numeric(27),
time_mle = numeric(27),
nu_low = numeric(27),
nu_high = numeric(27),
time_low = numeric(27),
time_high = numeric(27))
nu_tau_distribution
for (i in 1:length(likelihood_surface_file_list)) {
# nu_mle
nu_tau_distribution[i, 2] = return_nu_mle(likelihood_surface_file_list[i])
# nu_low
nu_tau_distribution[i, 4] = return_nu_low(likelihood_surface_file_list[i])
# nu_high
nu_tau_distribution[i, 5] =  return_nu_high(likelihood_surface_file_list[i])
# tau_mle
nu_tau_distribution[i, 3] = return_time_mle(likelihood_surface_file_list[i],
synonymous_sfs_file_list[i],
two_epoch_file_list[i])
# tau_low
nu_tau_distribution[i, 6] = return_time_low(likelihood_surface_file_list[i],
synonymous_sfs_file_list[i],
two_epoch_file_list[i])
# tau_high
nu_tau_distribution[i, 7] =  return_time_high(likelihood_surface_file_list[i],
synonymous_sfs_file_list[i],
two_epoch_file_list[i])
}
nu_tau_distribution$species = factor(nu_tau_distribution$species, levels=phylogenetic_levels)
nu_label_text = expression(nu == frac(N[current], N[ancestral]))
# tau_label_text = expression(tau == frac(generations, 2 * N[ancestral]))
tau_label_text = 'Estimated time in years since most recent demographic event'
# 1000 x 1000
plot_nu_distribution = ggplot() +
geom_linerange(data=nu_tau_distribution, mapping=aes(x=fct_rev(species), ymin=nu_low, ymax=nu_high), size=1, color="blue") +
geom_point(data=nu_tau_distribution, mapping=aes(x=fct_rev(species), y=nu_mle), size=4, shape=21, fill="white") +
scale_y_log10() +
coord_flip() +
theme_bw() +
xlab('') +
ylab(nu_label_text) +
geom_hline(yintercept=1.0, color='red', linewidth=1, linetype='dashed') +
theme(axis.text.y = element_text(face='italic')) +
theme(axis.text.y = element_text(hjust=0)) +
theme(axis.text=element_text(size=16)) +
theme(axis.title=element_text(size=16,face="bold"))
plot_nu_distribution
plot_tau_distribution = ggplot() +
geom_linerange(data=nu_tau_distribution, mapping=aes(x=fct_rev(species), ymin=time_low, ymax=time_high), size=1, color="blue") +
geom_point(data=nu_tau_distribution, mapping=aes(x=fct_rev(species), y=time_mle), size=4, shape=21, fill="white") +
scale_y_log10() +
coord_flip() +
theme_bw() +
xlab('') +
ylab(tau_label_text) +
theme(axis.text.y = element_text(face='italic')) +
theme(axis.text.y = element_text(hjust=0)) +
theme(axis.text=element_text(size=16)) +
theme(axis.title=element_text(size=16,face="bold"))
plot_tau_distribution
plot_nu_distribution_fig = ggplot() +
geom_linerange(data=nu_tau_distribution, mapping=aes(x=fct_rev(species), ymin=nu_low, ymax=nu_high, col=species), size=1, show.legend = FALSE) +
geom_point(data=nu_tau_distribution, mapping=aes(x=fct_rev(species), y=nu_mle, col=species), size=4, shape=18,  show.legend = FALSE) +
scale_y_log10() +
coord_flip() +
theme_bw() +
xlab('') +
ylab(nu_label_text) +
geom_hline(yintercept=1.0, color='red', linewidth=1, linetype='dashed') +
theme(axis.text.y = element_blank()) +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=16))
plot_nu_distribution_fig
plot_tau_distribution_fig = ggplot() +
geom_linerange(data=nu_tau_distribution, mapping=aes(x=fct_rev(species), ymin=time_low, ymax=time_high, col=species), size=1, show.legend = FALSE) +
geom_point(data=nu_tau_distribution, mapping=aes(x=fct_rev(species), y=time_mle, col=species), size=4, shape=18, show.legend = FALSE) +
scale_y_log10() +
coord_flip() +
theme_bw() +
xlab('') +
ylab(tau_label_text) +
theme(axis.text.y = element_blank()) +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=16))
plot_tau_distribution_fig
### Figure S2
# 2000 x 1100
plot_nu_distribution_fig + plot_tau_distribution_fig + plot_layout(ncol=2)
### Figure 3
demography_df = nu_tau_distribution[1:3]
demography_df$species = factor(demography_df$species, levels=phylogenetic_levels)
species_highlight = c('Akkermansia muciniphila', 'Ruminococcus bromii')
typeface = ifelse(demography_df$species %in% species_highlight, 5, 4)
demography_df_highlight = demography_df[demography_df$species %in% species_highlight, ]
options(ggrepel.max.overlaps = Inf)
x_label_text = expression(nu == frac(N[current], N[ancestral]))
demography_scatter = ggscatter(demography_df, x="nu_mle", y="time_mle", color="species", shape=18, size=4) +
ylab('Estimated time in years since most recent demographic event') +
xlab(x_label_text) +
geom_vline(xintercept=1.0, color='red', linewidth=1, linetype='dashed') +
scale_shape_manual(name = "Best-Fit Demographic Model",
labels = c("Three Epoch", "Two Epoch"),
values = c(17, 19)) +
geom_text_repel(aes(label = species, color=species, fontface = 'italic'), size=typeface) +
guides(color=guide_legend(title="Species")) +
#scale_x_log10(limits=c(1e-2, 2e4)) +
#scale_y_log10(limits=c(3e2, 5e6)) +
scale_x_log10() +
scale_y_log10() +
theme(legend.position = 'none') +
guides(color = 'none') +
guides(shape = 'none')  +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=16))
demography_scatter
design = c(
area(1, 1, 1, 1),
area(1, 2, 1, 2),
area(2, 1, 2, 1),
area(2, 2, 2, 2),
area(1, 3, 2, 6)
#area(3, 3, 6, 4),
#area(3, 5, 6, 6)
)
p1 = plot_best_fit_sfs_3A(a_muciniphila_best_fit) + ggtitle('Akkermansia muciniphila')
p1_l = plot_likelihood_surface_contour_3C('../Analysis/Akkermansia_muciniphila_55290_downsampled_14/core_likelihood_surface.csv')
p30 = plot_best_fit_sfs_3B(r_bromii_best_fit) + ggtitle('Ruminococcus bromii')
p30_l = plot_likelihood_surface_contour_3D('../Analysis/Ruminococcus_bromii_62047_downsampled_14/core_likelihood_surface.csv')
# 2000 x 900
p1 + p1_l + # A. muciniphila
p30 + p30_l + #R. bicirculans
demography_scatter +
plot_layout(design=design)
# 2000 x 1900
# p1 + p1_l + # A. muciniphila
#   p30 + p30_l + #R. bicirculans
#   demography_scatter +
#   plot_nu_distribution_fig +
#   plot_tau_distribution_fig +
#   plot_layout(design=design)
# Accessory vs. Core genes demographic comparison
accessory_core_demography = data.frame(species=phylogenetic_levels,
core_nu = numeric(27),
core_years = numeric(27),
core_na = numeric(27),
acc_nu = numeric(27),
acc_years = numeric(27),
acc_na = numeric(27))
for (i in 1:length(two_epoch_file_list)) {
accessory_core_demography[i, 2:4] = read_demography_info(two_epoch_file_list[i])
accessory_core_demography[i, 5:7] = read_demography_info(accessory_two_epoch_file_list[i])
}
colnames(accessory_core_demography) = c('Species',
'Core, Nu',
'Core, Years',
'Core, N_anc',
'Accessory, Nu',
'Accessory, Years',
'Accessory, N_Anc')
# write.csv(accessory_core_demography, '../Summary/accessory_core_demography_comparison.csv', row.names=FALSE)
accessory_core_demography$`Accessory, N_Anc`
accessory_core_demography[c(7, 13, 14, 17, 18, 22, 23, 27), ]
ggplot(accessory_core_demography[c(7, 13, 14, 17, 18, 22, 23, 27), ], aes(x = `Core, N_anc`, y = `Accessory, N_Anc`)) +
geom_point(aes(color=Species), show.legend=FALSE) +
labs(x = "Core genes", y = "Accessory genes") +
ggtitle("Estimated ancestral effective population size") +
geom_abline(slope = 1, intercept = 0, color = "red", linetype = "dashed") +
xlim(0, 4E7) +
ylim(0, 4E7) +
geom_text_repel(aes(label = Species, color=Species, fontface = 'italic'), show.legend = FALSE) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))
### Supplemental Table 3
one_epoch_likelihood = numeric(27)
one_epoch_AIC = numeric(27)
one_epoch_theta = numeric(27)
one_epoch_nanc = numeric(27)
two_epoch_likelihood = numeric(27)
two_epoch_AIC = numeric(27)
two_epoch_nu = numeric(27)
two_epoch_tau = numeric(27)
two_epoch_time = numeric(27)
two_epoch_theta = numeric(27)
two_epoch_nanc = numeric(27)
three_epoch_likelihood = numeric(27)
three_epoch_AIC = numeric(27)
three_epoch_nu_bottleneck = numeric(27)
three_epoch_nu_contemporary = numeric(27)
three_epoch_tau_bottleneck = numeric(27)
three_epoch_tau_contemporary = numeric(27)
three_epoch_time_total = numeric(27)
three_epoch_theta = numeric(27)
three_epoch_nanc = numeric(27)
for (i in 1:length(one_epoch_file_list)) {
one_epoch_likelihood[i] = return_demography_likelihood(one_epoch_file_list[i])
one_epoch_AIC[i] = AIC_from_demography(one_epoch_file_list[i])
one_epoch_theta[i] = theta_from_demography(one_epoch_file_list[i])
one_epoch_nanc[i] = nanc_from_demography(one_epoch_file_list[i])
two_epoch_likelihood[i] = return_demography_likelihood(two_epoch_file_list[i])
two_epoch_AIC[i] = AIC_from_demography(two_epoch_file_list[i])
two_epoch_nu[i] = return_demography_params(two_epoch_file_list[i])[1]
two_epoch_tau[i] = return_demography_params(two_epoch_file_list[i])[2]
two_epoch_time[i] = time_from_demography(two_epoch_file_list[i])
two_epoch_theta[i] = theta_from_demography(two_epoch_file_list[i])
two_epoch_nanc[i] = nanc_from_demography(two_epoch_file_list[i])
three_epoch_likelihood[i] = return_demography_likelihood(three_epoch_file_list[i])
three_epoch_AIC[i] = AIC_from_demography(three_epoch_file_list[i])
three_epoch_nu_bottleneck[i] = return_demography_params(three_epoch_file_list[i])[1]
three_epoch_nu_contemporary[i] = return_demography_params(three_epoch_file_list[i])[2]
three_epoch_tau_bottleneck[i] = return_demography_params(three_epoch_file_list[i])[3]
three_epoch_tau_contemporary[i] = return_demography_params(three_epoch_file_list[i])[4]
three_epoch_time_total[i] = time_from_demography(three_epoch_file_list[i])
three_epoch_theta[i] = theta_from_demography(three_epoch_file_list[i])
three_epoch_nanc[i] = nanc_from_demography(three_epoch_file_list[i])
}
table_s3 = data.frame(
species=phylogenetic_levels,
one_epoch_likelihood,
one_epoch_AIC,
one_epoch_theta,
one_epoch_nanc,
two_epoch_likelihood,
two_epoch_AIC,
two_epoch_nu,
two_epoch_tau,
two_epoch_time,
two_epoch_theta,
two_epoch_nanc,
three_epoch_likelihood,
three_epoch_AIC,
three_epoch_nu_bottleneck,
three_epoch_nu_contemporary,
three_epoch_tau_bottleneck,
three_epoch_tau_contemporary,
three_epoch_time_total,
three_epoch_theta,
three_epoch_nanc
)
names(table_s3) = c(
'Species',
'One epoch, log likelihood',
'One epoch, AIC',
'One epoch, theta',
'One epoch, Ancestral effective population size',
'Two epoch, log likelihood',
'Two epoch, AIC',
'Two epoch, nu',
'Two epoch, tau',
'Two epoch, time in years',
'Two epoch, theta',
'Two epoch, Ancestral effective population size',
'Three epoch, log likelihood',
'Three epoch, AIC',
'Three epoch, nu (bottleneck)',
'Three epoch, nu (contemporary)',
'Three epoch, tau (bottleneck)',
'Three epoch, tau (contemporary)',
'Three epoch, time in years',
'Three epoch, theta',
'Three epoch, Ancestral effective population size'
)
write.csv(table_s3, '../Summary/Supplemental_Table_3.csv', row.names = F)
### Supplemental Table 4
names(nu_tau_distribution) = c(
'Species',
'Nu, MLE',
'Time in years, MLE',
'Low estimate of Nu',
'High estimate of Nu',
'Low estimate of time in years',
'High estimate of time in years'
)
write.csv(nu_tau_distribution, '../Summary/Supplemental_Table_4.csv', row.names = F)
### Supplemental Table 5
dfe_nanc = numeric(27)
gamma_AIC = numeric(27)
gamma_alpha = numeric(27)
gamma_beta = numeric(27)
neugamma_likelihood = numeric(27)
neugamma_AIC = numeric(27)
neugamma_pneu = numeric(27)
neugamma_alpha = numeric(27)
neugamma_beta = numeric(27)
for (i in 1:length(DFE_file_list)) {
dfe_nanc[i] = nanc_from_demography(two_epoch_file_list[i])
gamma_likelihood[i] = return_DFE_likelihood(DFE_file_list[i])[1]
gamma_AIC[i] = 4 - 2 * gamma_likelihood[i]
gamma_alpha[i] = return_DFE_params(DFE_file_list[i])[1]
gamma_beta[i] = return_DFE_params(DFE_file_list[i])[2]
neugamma_likelihood[i] = return_DFE_likelihood(DFE_file_list[i])[2]
neugamma_AIC[i] = 6 - 2 * neugamma_likelihood[i]
neugamma_pneu[i] = return_DFE_params(DFE_file_list[i])[3]
neugamma_alpha[i] = return_DFE_params(DFE_file_list[i])[4]
neugamma_beta[i] = return_DFE_params(DFE_file_list[i])[5]
}
