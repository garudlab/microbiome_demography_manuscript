phascolarctobacterium_sp_best_fit = cbind(
proportional_sfs(phascolarctobacterium_sp_hmp_qp_syn[-1]),
proportional_sfs(phascolarctobacterium_sp_complete_two_epoch),
proportional_sfs(phascolarctobacterium_sp_hmp_qp_nonsyn[-1]),
proportional_sfs(phascolarctobacterium_sp_complete_gamma_dfe),
rep('Phascolarctobacterium sp', length(phascolarctobacterium_sp_hmp_qp_syn[-1])),
x_axis
)
p_copri_best_fit = cbind(
proportional_sfs(p_copri_hmp_qp_syn[-1]),
proportional_sfs(p_copri_complete_two_epoch),
proportional_sfs(p_copri_hmp_qp_nonsyn[-1]),
proportional_sfs(p_copri_complete_gamma_dfe),
rep('P. copri', length(p_copri_hmp_qp_syn[-1])),
x_axis
)
r_bicirculans_best_fit = cbind(
proportional_sfs(r_bicirculans_hmp_qp_syn[-1]),
proportional_sfs(r_bicirculans_complete_two_epoch),
proportional_sfs(r_bicirculans_hmp_qp_nonsyn[-1]),
proportional_sfs(r_bicirculans_complete_gamma_dfe),
rep('R. bicirculans', length(r_bicirculans_hmp_qp_syn[-1])),
x_axis
)
r_bromii_best_fit = cbind(
proportional_sfs(r_bromii_hmp_qp_syn[-1]),
proportional_sfs(r_bromii_complete_two_epoch),
proportional_sfs(r_bromii_hmp_qp_nonsyn[-1]),
proportional_sfs(r_bromii_complete_gamma_dfe),
rep('R. bromii', length(r_bromii_hmp_qp_syn[-1])),
x_axis
)
# 800 x 1200
# Phylogenetic Tree in APE
get_species_code_reference = function(code, reference) {
if (code %in% reference$species_id) {
return(reference[reference$species_id == code, ]$midas_number)
} else if(code %in% reference$midas_number) {
return(reference[reference$midas_number == code, ]$species_id)
}
}
# Read the input TSV file
input_table <- read.table("../Data/midas_tree/midas_db_v1.2/species_info.txt", header = TRUE, sep = "\t", stringsAsFactors = FALSE)
# Extract the midas_number from the species_id column
input_table$midas_number <- sub(".+_(\\d+)$", "\\1", input_table$species_id)
# Create a new data frame with species_id and midas_number columns
output_table <- data.frame(species_id = input_table$species_id, midas_number = input_table$midas_number)
# Save the output as a CSV file
write.csv(output_table, file = "../Data/midas_tree/midas_db_v1.2/species_code_reference.txt", row.names = FALSE)
# Print the output data frame
print(output_table)
# Load the ape package
# library(ape)
# Read the Newick file
input_tree <- read.tree("../Data/midas_tree/midas_db_v1.2/species_tree.newick")
# Specify the tip labels for the subtree you want to extract
species_subtree = c(
'Akkermansia_muciniphila_55290',
'Alistipes_finegoldii_56071',
'Alistipes_onderdonkii_55464',
# 'Alistipes_putredinis_61533',
'Alistipes_shahii_62199',
'Bacteroidales_bacterium_58650',
# 'Bacteroides_caccae_53434',
'Bacteroides_cellulosilyticus_58046',
'Bacteroides_fragilis_54507',
# 'Bacteroides_massiliensis_44749',
# 'Bacteroides_ovatus_58035',
'Bacteroides_stercoris_56735',
'Bacteroides_thetaiotaomicron_56941',
# 'Bacteroides_uniformis_57318',
'Bacteroides_vulgatus_57955',
'Bacteroides_xylanisolvens_57185',
'Barnesiella_intestinihominis_62208',
# 'Coprococcus_sp_62244',
# 'Dialister_invisus_61905',
'Eubacterium_eligens_61678',
'Eubacterium_rectale_56927',
'Faecalibacterium_prausnitzii_57453',
'Odoribacter_splanchnicus_62174',
'Oscillibacter_sp_60799',
'Parabacteroides_distasonis_56985',
'Parabacteroides_merdae_56972',
'Phascolarctobacterium_sp_59817',
'Prevotella_copri_61740',
'Ruminococcus_bicirculans_59300',
'Ruminococcus_bromii_62047'
)
midas_code_subtree = c()
for (species in species_subtree) {
midas_code_subtree = c(midas_code_subtree, get_species_code_reference(species, output_table))
}
print(midas_code_subtree)
subtree_tips = midas_code_subtree
# Extract the subtree
subtree <- keep.tip(input_tree, subtree_tips)
# Print the extracted subtree
print(subtree)
for (i in 1:length(subtree$tip.label)) {
print(subtree$tip.label[i])
new_tip = get_species_code_reference(subtree$tip.label[i], output_table)
# new_tip = str_sub(new_tip, 1, str_length(new_tip)-6)
subtree$tip.label[i] = new_tip
print(subtree$tip.label[i])
}
plot(subtree)
write.tree(subtree, file='../Summary/good_species.newick')
# Likelihood Surfaces
plot_likelihood_surface_contour('../Analysis/Akkermansia_muciniphila_55290_downsampled_14/likelihood_surface.csv')
plot_likelihood_surface_contour('../Analysis/Akkermansia_muciniphila_55290_downsampled_14/likelihood_surface.csv') + ggtitle('A. muciniphila likelihood surface')
plot_likelihood_surface_contour('../Analysis/Alistipes_finegoldii_56071_downsampled_14/likelihood_surface.csv') + ggtitle('A. finegoldii likelihood surface')
plot_likelihood_surface_contour('../Analysis/Alistipes_onderdonkii_55464_downsampled_14/likelihood_surface.csv') + ggtitle('A. onderdonkii likelihood surface')
# plot_likelihood_surface('../Analysis/Alistipes_putredinis_61533_downsampled_14/likelihood_surface.csv') + ggtitle('A. muciniphila likelihood surface')
plot_likelihood_surface_contour('../Analysis/Alistipes_shahii_62199_downsampled_14/likelihood_surface.csv') + ggtitle('A. shahii likelihood surface')
plot_likelihood_surface_contour('../Analysis/Bacteroidales_bacterium_58650_downsampled_14/likelihood_surface.csv') + ggtitle('B. bacterium likelihood surface')
# plot_likelihood_surface('../Analysis/Bacteroides_caccae_53434_downsampled_14/likelihood_surface.csv') + ggtitle('B. caccae likelihood surface')
plot_likelihood_surface('../Analysis/Bacteroides_cellulosilyticus_58046_downsampled_14/likelihood_surface.csv') + ggtitle('B. cellulosilyticus likelihood surface')
plot_likelihood_surface_contour('../Analysis/Bacteroides_cellulosilyticus_58046_downsampled_14/likelihood_surface.csv') + ggtitle('B. cellulosilyticus likelihood surface')
plot_likelihood_surface_contour('../Analysis/Bacteroides_fragilis_54507_downsampled_14/likelihood_surface.csv') + ggtitle('B. fragilis likelihood surface')
# plot_likelihood_surface('../Analysis/Bacteroides_massiliensis_44749_downsampled_14/likelihood_surface.csv') + ggtitle('A. muciniphila likelihood surface')
# plot_likelihood_surface('../Analysis/Bacteroides_ovatus_58035_downsampled_14/likelihood_surface.csv') + ggtitle('A. muciniphila likelihood surface')
plot_likelihood_surface_contour('../Analysis/Bacteroides_stercoris_56735_downsampled_14/likelihood_surface.csv') + ggtitle('B. stercoris likelihood surface')
plot_likelihood_surface_contour('../Analysis/Bacteroides_thetaiotaomicron_56941_downsampled_14/likelihood_surface.csv') + ggtitle('B. thetaiotaomicron likelihood surface')
# plot_likelihood_surface('../Analysis/Bacteroides_uniformis_57318_downsampled_14/likelihood_surface.csv') + ggtitle('A. muciniphila likelihood surface')
plot_likelihood_surface_contour('../Analysis/Bacteroides_vulgatus_57955_downsampled_14/likelihood_surface.csv') + ggtitle('B. vulgatus likelihood surface')
plot_likelihood_surface_contour('../Analysis/Bacteroides_xylanisolvens_57185_downsampled_14/likelihood_surface.csv') + ggtitle('B. xylanisolvens likelihood surface')
plot_likelihood_surface_contour('../Analysis/Barnesiella_intestinihominis_62208_downsampled_14/likelihood_surface.csv') + ggtitle('B. intestinihominis likelihood surface')
# plot_likelihood_surface('../Analysis/Coprococcus_sp_62244_downsampled_14/likelihood_surface.csv') + ggtitle('A. muciniphila likelihood surface')
# plot_likelihood_surface('../Analysis/Dialister_invisus_61905_downsampled_14/likelihood_surface.csv') + ggtitle('A. muciniphila likelihood surface')
plot_likelihood_surface('../Analysis/Eubacterium_eligens_61678_downsampled_14/likelihood_surface.csv') + ggtitle('E. eligens likelihood surface')
plot_likelihood_surface_contour('../Analysis/Eubacterium_eligens_61678_downsampled_14/likelihood_surface.csv') + ggtitle('E. eligens likelihood surface')
plot_likelihood_surface_contour('../Analysis/Eubacterium_rectale_56927_downsampled_14/likelihood_surface.csv') + ggtitle('E. rectale likelihood surface')
plot_likelihood_surface_contour('../Analysis/Faecalibacterium_prausnitzii_57453_downsampled_14/likelihood_surface.csv') + ggtitle('F. prausnitzii likelihood surface')
plot_likelihood_surface('../Analysis/Odoribacter_splanchnicus_62174_downsampled_14/likelihood_surface.csv') + ggtitle('O. splanchnicus likelihood surface')
plot_likelihood_surface_contour('../Analysis/Odoribacter_splanchnicus_62174_downsampled_14/likelihood_surface.csv') + ggtitle('O. splanchnicus likelihood surface')
plot_likelihood_surface_contour('../Analysis/Oscillibacter_sp_60799_downsampled_14/likelihood_surface.csv') + ggtitle('Oscillibacter species likelihood surface')
plot_likelihood_surface_contour('../Analysis/Parabacteroides_distasonis_56985_downsampled_14/likelihood_surface.csv') + ggtitle('P. distasonis likelihood surface')
plot_likelihood_surface_contour('../Analysis/Parabacteroides_merdae_56972_downsampled_14/likelihood_surface.csv') + ggtitle('P. merdae likelihood surface')
plot_likelihood_surface_contour('../Analysis/Phascolarctobacterium_sp_59817_downsampled_14/likelihood_surface.csv') + ggtitle('Phascolarctobacterium species likelihood surface')
plot_likelihood_surface_contour('../Analysis/Prevotella_copri_61740_downsampled_14/likelihood_surface.csv') + ggtitle('P. copri likelihood surface')
plot_likelihood_surface_contour('../Analysis/Ruminococcus_bicirculans_59300_downsampled_14/likelihood_surface.csv') + ggtitle('R. bicirculans likelihood surface')
plot_likelihood_surface_contour('../Analysis/Ruminococcus_bromii_62047_downsampled_14/likelihood_surface.csv') + ggtitle('R. bromii likelihood surface')
p1 = plot_best_fit_sfs(a_muciniphila_best_fit) + ggtitle('Akkermansia muciniphila')
p2 = plot_best_fit_sfs(a_finegoldii_best_fit) + ggtitle('Alistipes finegoldii')
p3 = plot_best_fit_sfs(a_onderdonkii_best_fit) + ggtitle('Alistipes onderdonkii')
# p4 = plot_best_fit_sfs(_best_fit)
p5 = plot_best_fit_sfs(a_shahii_best_fit) + ggtitle('Alistipes shahii')
p6 = plot_best_fit_sfs(b_bacterium_best_fit) + ggtitle('Bacteroidales bacterium')
# p7 = plot_best_fit_sfs(_best_fit)
p8 = plot_best_fit_sfs(b_cellulosilyticus_best_fit) + ggtitle('Bacteroides cellulosilyticus')
p9 = plot_best_fit_sfs(b_fragilis_best_fit) + ggtitle('Bacteroides fragilis')
# p10 = plot_best_fit_sfs(_best_fit)
# p11 = plot_best_fit_sfs(_best_fit)
p12 = plot_best_fit_sfs(b_stercoris_best_fit) + ggtitle('Bacteroides stercoris')
p13 = plot_best_fit_sfs(b_thetaiotaomicron_best_fit) + ggtitle('Bacteroides thetaiotaomicron')
# p14 = plot_best_fit_sfs(_best_fit)
p15 = plot_best_fit_sfs(b_vulgatus_best_fit) + ggtitle('Bacteroides vulgatus')
p16 = plot_best_fit_sfs(b_xylanisolvens_best_fit) + ggtitle('Bacteroides xylanisolvens')
p17 = plot_best_fit_sfs(b_intestinihominis_best_fit) + ggtitle('Barnesiella intestinihominis')
# p18 = plot_best_fit_sfs(_best_fit)
# p19 = plot_best_fit_sfs(_best_fit)
p20 = plot_best_fit_sfs(e_eligens_best_fit) + ggtitle('Eubacterium eligens')
p21 = plot_best_fit_sfs(e_rectale_best_fit) + ggtitle('Eubacterium rectale')
p22 = plot_best_fit_sfs(f_prausnitzii_best_fit) + ggtitle('Faecalibacterium prausnitzii')
p23 = plot_best_fit_sfs(o_splanchnicus_best_fit) + ggtitle('Odoribacter splanchnicus')
p24 = plot_best_fit_sfs(oscillibacter_sp_best_fit) + ggtitle('Oscillibacter species')
p25 = plot_best_fit_sfs(p_distasonis_best_fit) + ggtitle('Parabacteroides distasonis')
p26 = plot_best_fit_sfs(p_merdae_best_fit) + ggtitle('Parabacteroides merdae')
p27 = plot_best_fit_sfs(phascolarctobacterium_sp_best_fit) + ggtitle('Phascolarctobacterium species')
p28 = plot_best_fit_sfs(p_copri_best_fit) + ggtitle('Prevotella copri')
p29 = plot_best_fit_sfs(r_bicirculans_best_fit) + ggtitle('Ruminococcus bicirculans')
p30 = plot_best_fit_sfs(r_bromii_best_fit) + ggtitle('Ruminococcus bromii')
p1_l = plot_likelihood_surface_contour('../Analysis/Akkermansia_muciniphila_55290_downsampled_14/likelihood_surface.csv')
p2_l = plot_likelihood_surface_contour('../Analysis/Alistipes_finegoldii_56071_downsampled_14/likelihood_surface.csv')
p3_l = plot_likelihood_surface_contour('../Analysis/Alistipes_onderdonkii_55464_downsampled_14/likelihood_surface.csv')
# p4 = plot_likelihood_surface_contour('../Analysis/Alistipes_putredinis_61533_downsampled_14/likelihood_surface.csv')
p5_l = plot_likelihood_surface_contour('../Analysis/Alistipes_shahii_62199_downsampled_14/likelihood_surface.csv')
p6_l = plot_likelihood_surface_contour('../Analysis/Bacteroidales_bacterium_58650_downsampled_14/likelihood_surface.csv')
# p7 = plot_likelihood_surface_contour('../Analysis/Bacteroides_caccae_53434_downsampled_14/likelihood_surface.csv')
p8_l = plot_likelihood_surface_contour('../Analysis/Bacteroides_cellulosilyticus_58046_downsampled_14/likelihood_surface.csv')
p9_l = plot_likelihood_surface_contour('../Analysis/Bacteroides_fragilis_54507_downsampled_14/likelihood_surface.csv')
# p10 = plot_likelihood_surface_contour('../Analysis/Bacteroides_massiliensis_44749_downsampled_14/likelihood_surface.csv')
# p11 = plot_likelihood_surface_contour('../Analysis/Bacteroides_ovatus_58035_downsampled_14/likelihood_surface.csv')
p12_l = plot_likelihood_surface_contour('../Analysis/Bacteroides_stercoris_56735_downsampled_14/likelihood_surface.csv')
p13_l = plot_likelihood_surface_contour('../Analysis/Bacteroides_thetaiotaomicron_56941_downsampled_14/likelihood_surface.csv')
# p14 = plot_likelihood_surface_contour('../Analysis/Bacteroides_uniformis_57318_downsampled_14/likelihood_surface.csv')
p15_l = plot_likelihood_surface_contour('../Analysis/Bacteroides_vulgatus_57955_downsampled_14/likelihood_surface.csv')
p16_l = plot_likelihood_surface_contour('../Analysis/Bacteroides_xylanisolvens_57185_downsampled_14/likelihood_surface.csv')
p17_l = plot_likelihood_surface_contour('../Analysis/Barnesiella_intestinihominis_62208_downsampled_14/likelihood_surface.csv')
# p18 = plot_likelihood_surface_contour('../Analysis/Coprococcus_sp_62244_downsampled_14/likelihood_surface.csv')
# p19 = plot_likelihood_surface_contour('../Analysis/Dialister_invisus_61905_downsampled_14/likelihood_surface.csv')
p20_l = plot_likelihood_surface_contour('../Analysis/Eubacterium_eligens_61678_downsampled_14/likelihood_surface.csv')
p21_l = plot_likelihood_surface_contour('../Analysis/Eubacterium_rectale_56927_downsampled_14/likelihood_surface.csv')
p22_l = plot_likelihood_surface_contour('../Analysis/Faecalibacterium_prausnitzii_57453_downsampled_14/likelihood_surface.csv')
p23_l = plot_likelihood_surface_contour('../Analysis/Odoribacter_splanchnicus_62174_downsampled_14/likelihood_surface.csv')
p24_l = plot_likelihood_surface_contour('../Analysis/Oscillibacter_sp_60799_downsampled_14/likelihood_surface.csv')
p25_l = plot_likelihood_surface_contour('../Analysis/Parabacteroides_distasonis_56985_downsampled_14/likelihood_surface.csv')
p26_l = plot_likelihood_surface_contour('../Analysis/Parabacteroides_merdae_56972_downsampled_14/likelihood_surface.csv')
p27_l = plot_likelihood_surface_contour('../Analysis/Phascolarctobacterium_sp_59817_downsampled_14/likelihood_surface.csv')
p28_l = plot_likelihood_surface_contour('../Analysis/Prevotella_copri_61740_downsampled_14/likelihood_surface.csv')
p29_l = plot_likelihood_surface_contour('../Analysis/Ruminococcus_bicirculans_59300_downsampled_14/likelihood_surface.csv')
p30_l = plot_likelihood_surface_contour('../Analysis/Ruminococcus_bromii_62047_downsampled_14/likelihood_surface.csv')
#phylogenetic_levels = c(
#  'Bacteroidales bacterium', p6
#  # 'Alistipes putredinis',
#  'Alistipes finegoldii', p2
#  'Alistipes onderdonkii', p3
#  'Alistipes shahii', p5
#  'Odoribacter splanchnicus',  p23
#  'Parabacteroides distasonis',  p25
#  'Parabacteroides merdae', p26
#  'Prevotella copri', p28
#  'Bacteroides fragilis',  p9
#  'Bacteroides cellulosilyticus', p8
#  'Bacteroides stercoris',  p12
#  # 'Bacteroides uniformis',
#  'Bacteroides thetaiotaomicron', p13
#  # 'Bacteroides ovatus',
#  'Bacteroides xylanisolvens', p16
#  # 'Bacteroides caccae',
#  # 'Bacteroides massiliensis',
#  'Bacteroides vulgatus', p15
#  'Barnesiella intestinihominis', p17
#  'Akkermansia muciniphila', p1
#  # 'Dialister invivus',
#  'Phascolarctobacterium species', p27
#  'Eubacterium eligens', p20
#  'Eubacterium rectale', p21
#  # 'Coprococcus species',
#  'Oscillibacter species', p24
#  'Ruminococcus bromii', p30
#  'Ruminococcus bicirculans',  p29
#  'Faecalibacterium prausnitzii' p22
#)
# 1600 x 16000
sfs_and_likelihood = p6 + p6_l +
p2 + p2_l +
p3 + p3_l +
p5 + p5_l +
p23 + p23_l +
p25 + p25_l +
p26 + p26_l  +
p28 + p28_l +
p9 + p9_l +
p8 + p8_l +
p12 + p12_l +
p13 + p13_l +
p16 + p16_l +
p15 + p15_l +
p17 + p17_l +
p1 + p1_l +
p27 + p27_l +
p20 + p20_l +
p21 + p21_l +
p24 + p24_l +
p30 + p30_l +
p29 + p29_l +
p22 + p22_l +
plot_layout(ncol=2)
# 3200 x 16000
# Reorder area distribution
# Take out E. eligens
# Rescaale legends to match font size
# Legend in upper right corner of figure
### Figure 3
design = c(
area(1, 1, 1, 1),
area(1, 2, 1, 2),
area(2, 1, 2, 1),
area(2, 2, 2, 2),
area(1, 3, 2, 5)
)
p1 = plot_best_fit_sfs_3A(a_muciniphila_best_fit) + ggtitle('Akkermansia muciniphila')
p1_l = plot_likelihood_surface_contour_3C('../Analysis/Akkermansia_muciniphila_55290_downsampled_14/likelihood_surface.csv')
p30 = plot_best_fit_sfs_3B(r_bromii_best_fit) + ggtitle('Ruminococcus bromii')
p30_l = plot_likelihood_surface_contour_3D('../Analysis/Ruminococcus_bromii_62047_downsampled_14/likelihood_surface.csv')
# 2000 x 900
p1 + p1_l + # A. muciniphila
p30 + p30_l + #R. bicirculans
demography_scatter +
plot_layout(design=design)
# Nucleotide diversity
pi_summary_df = data.frame(read.csv('../Analysis/summarized_pi.csv', header=TRUE))
names(pi_summary_df) = c('species', 'Cohort', 'average_pi', 'num_sites',
'num_samples', 'aggregate_across_pi', 'pairwise_across_pi')
list_iid = c('Bifidobacterium_longum_57796',
'Blautia_wexlerae_56130',
'Butyrivibrio_crossotus_61674',
'Escherichia_coli_58110',
'Eubacterium_eligens_61678',
'Faecalibacterium_cf_62236',
'Faecalibacterium_prausnitzii_57453',
'Faecalibacterium_prausnitzii_61481',
'Faecalibacterium_prausnitzii_62201',
'Oscillibacter_sp_60799',
'Prevotella_copri_61740',
'Roseburia_inulinivorans_61943',
'Ruminococcus_bromii_62047')
over_iid_df = subset(pi_summary_df, species %in% list_iid)
position_jitterdodge(
jitter.width = NULL,
jitter.height = 0,
dodge.width = 0.5,
seed = NA
)
# pairwise_pi_comparison_10 + stat_compare_means(label = "p.signif", method = "t.test")
over_iid_df$ordered_pi = 0
over_iid_df[over_iid_df$species=='Bifidobacterium_longum_57796' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Bifidobacterium_longum_57796' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Bifidobacterium_longum_57796' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Bifidobacterium_longum_57796' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Blautia_wexlerae_56130' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Blautia_wexlerae_56130' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Blautia_wexlerae_56130' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Blautia_wexlerae_56130' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Butyrivibrio_crossotus_61674' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Butyrivibrio_crossotus_61674' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Butyrivibrio_crossotus_61674' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Butyrivibrio_crossotus_61674' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Eubacterium_eligens_61678' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Eubacterium_eligens_61678' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Eubacterium_eligens_61678' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Eubacterium_eligens_61678' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Escherichia_coli_58110' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Escherichia_coli_58110' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Escherichia_coli_58110' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Escherichia_coli_58110' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Faecalibacterium_cf_62236' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Faecalibacterium_cf_62236' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Faecalibacterium_cf_62236' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Faecalibacterium_cf_62236' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Faecalibacterium_prausnitzii_61481' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Faecalibacterium_prausnitzii_61481' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Faecalibacterium_prausnitzii_61481' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Faecalibacterium_prausnitzii_61481' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Faecalibacterium_prausnitzii_57453' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Faecalibacterium_prausnitzii_57453' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Faecalibacterium_prausnitzii_57453' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Faecalibacterium_prausnitzii_57453' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Faecalibacterium_prausnitzii_62201' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Faecalibacterium_prausnitzii_62201' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Faecalibacterium_prausnitzii_62201' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Faecalibacterium_prausnitzii_62201' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Oscillibacter_sp_60799' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Oscillibacter_sp_60799' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Oscillibacter_sp_60799' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Oscillibacter_sp_60799' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Prevotella_copri_61740' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Prevotella_copri_61740' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Prevotella_copri_61740' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Prevotella_copri_61740' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Roseburia_inulinivorans_61943' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Roseburia_inulinivorans_61943' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Roseburia_inulinivorans_61943' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Roseburia_inulinivorans_61943' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Ruminococcus_bromii_62047' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Ruminococcus_bromii_62047' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Ruminococcus_bromii_62047' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Ruminococcus_bromii_62047' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Ruminococcus_bromii_62047' & over_iid_df$Cohort==' HMP', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Ruminococcus_bromii_62047' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
over_iid_df[over_iid_df$species=='Ruminococcus_bromii_62047' & over_iid_df$Cohort==' African', ]$ordered_pi =
mean(over_iid_df[over_iid_df$species=='Ruminococcus_bromii_62047' & over_iid_df$Cohort==' African', ]$pairwise_across_pi)
unique(over_iid_df$species)
over_iid_df$species[over_iid_df$species == 'Bifidobacterium_longum_57796'] = 'Bifidobacterium longum'
over_iid_df$species[over_iid_df$species == 'Blautia_wexlerae_56130'] = 'Blautia wexlerae'
over_iid_df$species[over_iid_df$species == 'Butyrivibrio_crossotus_61674'] = 'Butyrivibrio crossotus'
over_iid_df$species[over_iid_df$species == 'Eubacterium_eligens_61678'] = 'Eubacterium eligens'
over_iid_df$species[over_iid_df$species == 'Escherichia_coli_58110'] = 'Escherichia coli'
over_iid_df$species[over_iid_df$species == 'Faecalibacterium_prausnitzii_61481'] = 'Faecalibacterium prausnitzii (61481)'
over_iid_df$species[over_iid_df$species == 'Faecalibacterium_prausnitzii_57453'] = 'Faecalibacterium prausnitzii (57453)'
over_iid_df$species[over_iid_df$species == 'Faecalibacterium_prausnitzii_62201'] = 'Faecalibacterium prausnitzii (62201)'
over_iid_df$species[over_iid_df$species == 'Faecalibacterium_cf_62236'] = 'Faecalibacterium cf'
over_iid_df$species[over_iid_df$species == 'Oscillibacter_sp_60799'] = 'Oscillibacter species'
over_iid_df$species[over_iid_df$species == 'Prevotella_copri_61740'] = 'Prevotella copri'
over_iid_df$species[over_iid_df$species == 'Roseburia_inulinivorans_61943'] = 'Roseburia inulinovrans'
over_iid_df$species[over_iid_df$species == 'Ruminococcus_bromii_62047'] = 'Ruminococcus bromii'
better_pi_comparison_iid <- ggplot(data=over_iid_df, aes(x=reorder(species, ordered_pi), y=average_pi, fill=Cohort)) +
geom_boxplot(aes(fill=Cohort), outlier.shape=NA) +
geom_point(pch = 21, position = position_jitterdodge(), size=1.5) +
geom_point(aes(x=species, y=pairwise_across_pi, color=Cohort), size=4, shape=16, position=position_dodge(width=0.75)) +
theme_bw() +
theme(plot.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) +
theme(axis.text.x = element_text(size=rel(1.5), angle=40, vjust=1.0, hjust=1)) +
theme(axis.text.y = element_text(size=rel(1.5))) +
theme(axis.title.x = element_blank()) +
theme(axis.title.y = element_text(size=rel(1.5))) +
scale_y_log10(breaks = trans_breaks("log10", function(x) 10^x),
labels = trans_format("log10", math_format(10^.x,)),
limits = c(0.0001, 0.2)) +
scale_fill_manual(values=c('dodgerblue3', 'goldenrod1')) +
scale_color_manual(values=c('dodgerblue3', 'goldenrod1')) +
theme(axis.text.x=element_text(face="italic")) +
theme(legend.position = "none") +
xlab('Species') +
ylab('Nucleotide diversity') +
# ggtitle('Distribution of within and between-host nucleotide diversity across cohorts') +
# stat_compare_means(method='wilcox.test', label='p.signif', size=6)
stat_compare_means(method='wilcox.test', size=2)
better_pi_comparison_iid
distinct_iid_df = distinct(over_iid_df, pairwise_across_pi, .keep_all=TRUE)
distinct_df = distinct(pi_summary_df, pairwise_across_pi, .keep_all=TRUE)
HMP_distinct = distinct_df[distinct_df$Cohort==' HMP', ]$pairwise_across_pi
African_distinct = distinct_df[distinct_df$Cohort==' African', ]$pairwise_across_pi
HMP_distinct_pairwise = distinct_iid_df[distinct_iid_df$Cohort==' HMP', ]$pairwise_across_pi
African_distinct_pairwise = distinct_iid_df[distinct_iid_df$Cohort==' African', ]$pairwise_across_pi
wilcox.test(HMP_distinct_pairwise, African_distinct_pairwise, paired=TRUE, exact=TRUE)
wilcox.test(HMP_distinct, African_distinct, paired=FALSE, exact=TRUE)
hmp_summary_df = pi_summary_df[pi_summary_df$Cohort==' HMP', ]
afr_summary_df = pi_summary_df[pi_summary_df$Cohort==' African', ]
# Number of species in each cohort
length(unique(hmp_summary_df$species))
length(unique(afr_summary_df$species))
# Number of shared species
sum(unique(afr_summary_df$species) %in% unique(hmp_summary_df$species))
afr_species_freq = data.frame(table(afr_summary_df$species))
hmp_species_freq = data.frame(table(hmp_summary_df$species))
over_5_afr_species = afr_species_freq[afr_species_freq$Freq > 5, ]$Var1
over_5_hmp_species = hmp_species_freq[hmp_species_freq$Freq > 5, ]$Var1
over_5_species = unique(c(over_5_afr_species, over_5_hmp_species))
over_5_species_df = pi_summary_df[pi_summary_df$species %in% over_5_species, ]
# over_5_species_df = drop_duplicates(over_5_species_df, keep=False)
over_5_species_df = over_5_species_df[!duplicated(over_5_species_df$pairwise_across_pi), ]
over_5_species_df = over_5_species_df[order(over_5_species_df$species), ]
over_5_species_df
compare_iid_over_5_means <- ggplot(data=over_5_species_df, aes(x=Cohort, y=pairwise_across_pi, fill=Cohort)) +
geom_boxplot(aes(fill=Cohort), outlier.shape=NA) +
geom_point(pch = 21, position = position_jitterdodge(), size=1.5) +
theme_bw() +
theme(plot.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) +
theme(axis.text.x = element_text(size=rel(1.5), angle=40, vjust=1.0, hjust=1)) +
theme(axis.text.y = element_text(size=rel(1.5))) +
theme(axis.title.x = element_blank()) +
theme(axis.title.y = element_blank()) +
theme(legend.text = element_text(size=rel(1.5))) +
theme(legend.title = element_text(size=rel(1.5))) +
scale_fill_manual(values=c('dodgerblue3', 'goldenrod1')) +
scale_color_manual(values=c('dodgerblue3', 'goldenrod1')) +
scale_y_log10(breaks = trans_breaks("log10", function(x) 10^x),
labels = trans_format("log10", math_format(10^.x,)),
limits = c(0.0001, 0.2)) +
ylab('Mean Nucleotide diversity per Species') +
# ylim(0, 0.03) +
stat_compare_means(method='wilcox.test', label='p.signif', size=6)
# ggtitle('Mean Nucleotide diversity per Species between Cohorts')
compare_iid_over_5_means
better_pi_comparison_iid + compare_iid_over_5_means + plot_layout(widths = c(3, 1))
# 1500 x 900 dimensions for saved image
# Plot DFE Grid
DFE_grid_file_list = c(
'../Analysis/cross_species_dfe/Bacteroidales_bacterium_58650_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Alistipes_finegoldii_56071_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Alistipes_onderdonkii_55464_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Alistipes_shahii_62199_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Odoribacter_splanchnicus_62174_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Parabacteroides_distasonis_56985_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Parabacteroides_merdae_56972_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Prevotella_copri_61740_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Bacteroides_fragilis_54507_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Bacteroides_cellulosilyticus_58046_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Bacteroides_stercoris_56735_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Bacteroides_thetaiotaomicron_56941_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Bacteroides_xylanisolvens_57185_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Bacteroides_vulgatus_57955_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Barnesiella_intestinihominis_62208_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Akkermansia_muciniphila_55290_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Phascolarctobacterium_sp_59817_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Eubacterium_eligens_61678_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Eubacterium_rectale_56927_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Oscillibacter_sp_60799_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Ruminococcus_bromii_62047_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Ruminococcus_bicirculans_59300_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Faecalibacterium_prausnitzii_57453_likelihood_surface.csv')
for (species in DFE_grid_file_list) {
plot_dfe_grid(species)
}
# test
cross_species_dfe_comparison(
'../Analysis/cross_species_dfe/Akkermansia_muciniphila_55290_likelihood_surface.csv',
'../Analysis/cross_species_dfe/Alistipes_finegoldii_56071_likelihood_surface.csv')
dfe_comparison_matrix = matrix(, nrow=23, ncol=23)
for (i in 1:23) {
for (j in 1:23) {
print(DFE_grid_file_list[i])
print(DFE_grid_file_list[j])
comparison = cross_species_dfe_comparison(DFE_grid_file_list[i], DFE_grid_file_list[j])
print(comparison)
dfe_comparison_matrix[i, j] = comparison
}
}
dfe_comparison_matrix
write.csv(dfe_comparison_matrix, '../Analysis/cross_species_dfe/dfe_comparison_matrix.csv')
dfe_comparison_matrix = read.csv('../Analysis/cross_species_dfe/dfe_comparison_matrix.csv',
header=TRUE)
dfe_comparison_matrix = dfe_comparison_matrix[, -1]
row.names(dfe_comparison_matrix) = phylogenetic_levels
colnames(dfe_comparison_matrix) = phylogenetic_levels
dfe_comparison_matrix
pheatmap(dfe_comparison_matrix,
cluster_rows = F, cluster_cols = F, fontsize_number = 10,
display_numbers = T,
show_colnames     = FALSE,
show_rownames     = FALSE,
color = colorRampPalette(c('red','orange', 'yellow', 'white'), bias=0.05)(100),
legend=TRUE)
for (species in DFE_grid_file_list) {
plot_dfe_grid(species)
}
